{"version":3,"file":"img-lazy-processor.min.js","sources":["../src/check.js","../src/index.js"],"sourcesContent":["(function () {\n  'use strict'\n  // Judgment method from https://github.com/w3c/IntersectionObserver\n  if (typeof window !== 'object') {\n    return\n  }\n  if ('IntersectionObserver' in window &&\n    'IntersectionObserverEntry' in window &&\n    'intersectionRatio' in window.IntersectionObserverEntry.prototype &&\n    'isIntersecting' in window.IntersectionObserverEntry.prototype) {\n    return\n  }\n  throw TypeError('The browser does not support the IntersectionObserver API. You can add polyfill(https://github.com/w3c/IntersectionObserver) or [npm install intersection-observer] to solve this problem')\n})()\n","\nimport './check.js'\nconst PLACEHOLD_IMG = 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNi1jMDY3IDc5LjE1Nzc0NywgMjAxNS8wMy8zMC0yMzo0MDo0MiAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENDIDIwMTUgKFdpbmRvd3MpIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOkQ1RDk3QjBCQTUyQzExRThCQ0U4OEMxMDBGQTgwMkNDIiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOkQ1RDk3QjBDQTUyQzExRThCQ0U4OEMxMDBGQTgwMkNDIj4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6RDVEOTdCMDlBNTJDMTFFOEJDRTg4QzEwMEZBODAyQ0MiIHN0UmVmOmRvY3VtZW50SUQ9InhtcC5kaWQ6RDVEOTdCMEFBNTJDMTFFOEJDRTg4QzEwMEZBODAyQ0MiLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRmOlJERj4gPC94OnhtcG1ldGE+IDw/eHBhY2tldCBlbmQ9InIiPz7vHKjlAAAAEElEQVR42mL4//8/A0CAAQAI/AL+26JNFgAAAABJRU5ErkJggg=='\nconst LOAD_IMG = 'data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciCiAgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiIHByZXNlcnZlQXNwZWN0UmF0aW89InhNaWRZTWlkIiB3aWR0aD0iNjQiIGhlaWdodD0iNjQiIHZpZXdCb3g9IjAgMCA2NCA2NCI+CiAgPGRlZnM+CiAgICA8c3R5bGU+CiAgICAgIC5jbHMtMSB7CiAgICAgICAgZmlsbDogI2ZmZjsKICAgICAgICBmaWxsLXJ1bGU6IGV2ZW5vZGQ7CiAgICAgIH0KICAgIDwvc3R5bGU+CiAgPC9kZWZzPgogIDxwYXRoIGQ9Ik02MC4wNDksMzYuMDQ5IEw1Mi4wNDksMzYuMDQ5IEM0OS44NDAsMzYuMDQ5IDQ4LjA0OSwzNC4yNTkgNDguMDQ5LDMyLjA0OSBDNDguMDQ5LDI5Ljg0MCA0OS44NDAsMjguMDQ5IDUyLjA0OSwyOC4wNDkgTDYwLjA0OSwyOC4wNDkgQzYyLjI1OSwyOC4wNDkgNjQuMDQ5LDI5Ljg0MCA2NC4wNDksMzIuMDQ5IEM2NC4wNDksMzQuMjU5IDYyLjI1OSwzNi4wNDkgNjAuMDQ5LDM2LjA0OSBaTTQ5LjAwNiwyMC43MDEgQzQ3LjQ0MywyMi4yNjMgNDQuOTExLDIyLjI2MyA0My4zNDksMjAuNzAxIEM0MS43ODcsMTkuMTM5IDQxLjc4NywxNi42MDYgNDMuMzQ5LDE1LjA0NCBMNDkuMDA2LDkuMzg3IEM1MC41NjgsNy44MjUgNTMuMTAwLDcuODI1IDU0LjY2Miw5LjM4NyBDNTYuMjI0LDEwLjk0OSA1Ni4yMjQsMTMuNDgyIDU0LjY2MiwxNS4wNDQgTDQ5LjAwNiwyMC43MDEgWk0zMi4wMDAsNjQuMDk5IEMyOS43OTEsNjQuMDk5IDI4LjAwMCw2Mi4zMDggMjguMDAwLDYwLjA5OSBMMjguMDAwLDUyLjA5OSBDMjguMDAwLDQ5Ljg5MCAyOS43OTEsNDguMDk5IDMyLjAwMCw0OC4wOTkgQzM0LjIwOSw0OC4wOTkgMzYuMDAwLDQ5Ljg5MCAzNi4wMDAsNTIuMDk5IEwzNi4wMDAsNjAuMDk5IEMzNi4wMDAsNjIuMzA4IDM0LjIwOSw2NC4wOTkgMzIuMDAwLDY0LjA5OSBaTTMyLjAwMCwxNi4wMDAgQzI5Ljc5MSwxNi4wMDAgMjguMDAwLDE0LjIwOSAyOC4wMDAsMTIuMDAwIEwyOC4wMDAsNC4wMDAgQzI4LjAwMCwxLjc5MSAyOS43OTEsLTAuMDAwIDMyLjAwMCwtMC4wMDAgQzM0LjIwOSwtMC4wMDAgMzYuMDAwLDEuNzkxIDM2LjAwMCw0LjAwMCBMMzYuMDAwLDEyLjAwMCBDMzYuMDAwLDE0LjIwOSAzNC4yMDksMTYuMDAwIDMyLjAwMCwxNi4wMDAgWk0xNC45OTQsNTQuNzEyIEMxMy40MzIsNTYuMjc0IDEwLjkwMCw1Ni4yNzQgOS4zMzgsNTQuNzEyIEM3Ljc3Niw1My4xNTAgNy43NzYsNTAuNjE3IDkuMzM4LDQ5LjA1NSBMMTQuOTk0LDQzLjM5OCBDMTYuNTU3LDQxLjgzNiAxOS4wODksNDEuODM2IDIwLjY1MSw0My4zOTggQzIyLjIxMyw0NC45NjAgMjIuMjEzLDQ3LjQ5MyAyMC42NTEsNDkuMDU1IEwxNC45OTQsNTQuNzEyIFpNMTQuOTk0LDIwLjcwMSBMOS4zMzgsMTUuMDQ0IEM3Ljc3NiwxMy40ODIgNy43NzYsMTAuOTQ5IDkuMzM4LDkuMzg3IEMxMC45MDAsNy44MjUgMTMuNDMyLDcuODI1IDE0Ljk5NCw5LjM4NyBMMjAuNjUxLDE1LjA0NCBDMjIuMjEzLDE2LjYwNiAyMi4yMTMsMTkuMTM5IDIwLjY1MSwyMC43MDEgQzE5LjA4OSwyMi4yNjMgMTYuNTU3LDIyLjI2MyAxNC45OTQsMjAuNzAxIFpNMTUuOTUxLDMyLjA0OSBDMTUuOTUxLDM0LjI1OSAxNC4xNjAsMzYuMDQ5IDExLjk1MSwzNi4wNDkgTDMuOTUxLDM2LjA0OSBDMS43NDEsMzYuMDQ5IC0wLjA0OSwzNC4yNTkgLTAuMDQ5LDMyLjA0OSBDLTAuMDQ5LDI5Ljg0MCAxLjc0MSwyOC4wNDkgMy45NTEsMjguMDQ5IEwxMS45NTEsMjguMDQ5IEMxNC4xNjAsMjguMDQ5IDE1Ljk1MSwyOS44NDAgMTUuOTUxLDMyLjA0OSBaTTQ5LjAwNiw0My4zOTggTDU0LjY2Miw0OS4wNTUgQzU2LjIyNCw1MC42MTcgNTYuMjI0LDUzLjE1MCA1NC42NjIsNTQuNzEyIEM1My4xMDAsNTYuMjc0IDUwLjU2OCw1Ni4yNzQgNDkuMDA2LDU0LjcxMiBMNDMuMzQ5LDQ5LjA1NSBDNDEuNzg3LDQ3LjQ5MyA0MS43ODcsNDQuOTYwIDQzLjM0OSw0My4zOTggQzQ0LjkxMSw0MS44MzYgNDcuNDQzLDQxLjgzNiA0OS4wMDYsNDMuMzk4IFoiIGNsYXNzPSJjbHMtMSI+CiAgICA8YW5pbWF0ZVRyYW5zZm9ybSBhdHRyaWJ1dGVOYW1lPSJ0cmFuc2Zvcm0iIGJlZ2luPSIwcyIgZHVyPSIxcyIgdHlwZT0icm90YXRlIiBmcm9tPSIwIDMyIDMyIiB0bz0iMzYwIDMyIDMyIiByZXBlYXRDb3VudD0iaW5kZWZpbml0ZSIgLz4KICA8L3BhdGg+Cjwvc3ZnPgo='\nconst EMPTY_IMG = 'data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiBwcmVzZXJ2ZUFzcGVjdFJhdGlvPSJ4TWlkWU1pZCIgd2lkdGg9IjY0IiBoZWlnaHQ9IjY0IiB2aWV3Qm94PSIwIDAgNjQgNjQiPgogIDxkZWZzPgogICAgPHN0eWxlPgogICAgICAuY2xzLTEgewogICAgICAgIGZpbGw6ICNmZmY7CiAgICAgICAgZmlsbC1ydWxlOiBldmVub2RkOwogICAgICB9CiAgICA8L3N0eWxlPgogIDwvZGVmcz4KICA8cGF0aCBkPSJNNjAuMzcxLDYwLjAwMCBMMy42MzAsNjAuMDAwIEMxLjYyNSw2MC4wMDAgMC4wMDAsNTguMzg5IDAuMDAwLDU2LjQwMiBMMC4wMDAsOC41OTkgQzAuMDAwLDYuNjEyIDEuNjI1LDUuMDAwIDMuNjMwLDUuMDAwIEw2MC4zNzEsNS4wMDAgQzYyLjM3NSw1LjAwMCA2NC4wMDAsNi42MTIgNjQuMDAwLDguNTk5IEw2NC4wMDAsNTYuNDAyIEM2NC4wMDAsNTguMzg5IDYyLjM3NSw2MC4wMDAgNjAuMzcxLDYwLjAwMCBaTTU4LjY2NywxMi45NDkgQzU4LjY2NywxMS40ODEgNTcuNDY3LDEwLjI5MSA1NS45ODYsMTAuMjkxIEw4LjAxNCwxMC4yOTEgQzYuNTMzLDEwLjI5MSA1LjMzMywxMS40ODEgNS4zMzMsMTIuOTQ5IEw1LjMzMywzMy43NTcgQzEwLjQ4NSwzOC44OTYgMjIuNTg3LDQwLjU1MiAzMS4wMDgsMzIuNTAwIEMzOS44MzAsMjQuMDY2IDUzLjgyNiwyMy45MzAgNTguNjY3LDIzLjM2NSBMNTguNjY3LDEyLjk0OSBaTTE1LjYwNywyNC43MDQgQzEyLjQyOSwyNC43MDQgOS44NTIsMjIuMTUwIDkuODUyLDE4Ljk5OCBDOS44NTIsMTUuODQ3IDEyLjQyOSwxMy4yOTIgMTUuNjA3LDEzLjI5MiBDMTguNzg2LDEzLjI5MiAyMS4zNjMsMTUuODQ3IDIxLjM2MywxOC45OTggQzIxLjM2MywyMi4xNTAgMTguNzg2LDI0LjcwNCAxNS42MDcsMjQuNzA0IFoiIGNsYXNzPSJjbHMtMSIvPgo8L3N2Zz4K'\nconst ERROR_IMG = 'data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiBwcmVzZXJ2ZUFzcGVjdFJhdGlvPSJ4TWlkWU1pZCIgd2lkdGg9IjY0IiBoZWlnaHQ9IjY0IiB2aWV3Qm94PSIwIDAgNjQgNjQiPgogIDxkZWZzPgogICAgPHN0eWxlPgogICAgICAuY2xzLTEgewogICAgICAgIGZpbGw6ICNmZmY7CiAgICAgICAgZmlsbC1ydWxlOiBldmVub2RkOwogICAgICB9CiAgICA8L3N0eWxlPgogIDwvZGVmcz4KICA8cGF0aCBkPSJNNjAuMzc0LDYwLjAwMCBMMzQuNjM5LDYwLjAwMCBMNDEuMDg4LDQyLjY4MyBMMzQuNTU5LDI5LjcyNSBDNDMuMTUxLDIzLjk0NSA1NC4yNTQsMjMuODc4IDU4LjY0MiwyMy4zNjUgTDU4LjY0MiwxMi45NDkgQzU4LjY0MiwxMS40ODEgNTcuNDQzLDEwLjI5MSA1NS45NjQsMTAuMjkxIEwzNS4wNDIsMTAuMjkxIEwzNy4xNDcsNS4wMDAgTDYwLjM3NCw1LjAwMCBDNjIuMzc3LDUuMDAwIDY0LjAwMSw2LjYxMiA2NC4wMDEsOC41OTkgTDY0LjAwMSw1Ni40MDIgQzY0LjAwMSw1OC4zODkgNjIuMzc3LDYwLjAwMCA2MC4zNzQsNjAuMDAwIFpNOS44NzIsMTguOTk4IEM5Ljg3MiwxNS44NDcgMTIuNDQ2LDEzLjI5MiAxNS42MjIsMTMuMjkyIEMxOC43OTgsMTMuMjkyIDIxLjM3MywxNS44NDcgMjEuMzczLDE4Ljk5OCBDMjEuMzczLDIyLjE1MCAxOC43OTgsMjQuNzA0IDE1LjYyMiwyNC43MDQgQzEyLjQ0NiwyNC43MDQgOS44NzIsMjIuMTUwIDkuODcyLDE4Ljk5OCBaTTMuNjI1LDYwLjAwMCBDMS42MjMsNjAuMDAwIC0wLjAwMSw1OC4zODkgLTAuMDAxLDU2LjQwMiBMLTAuMDAxLDguNTk5IEMtMC4wMDEsNi42MTIgMS42MjMsNS4wMDAgMy42MjUsNS4wMDAgTDI4LjUzMyw1LjAwMCBMMjYuNDI4LDEwLjI5MSBMOC4wMzUsMTAuMjkxIEM2LjU1NiwxMC4yOTEgNS4zNTcsMTEuNDgxIDUuMzU3LDEyLjk0OSBMNS4zNTcsMzMuNzU3IEM3Ljg3MSwzNi4yNjcgMTEuOTE2LDM3LjkwMCAxNi41NTQsMzcuOTAwIEMyMC4zOTUsMzcuOTAwIDI0LjY0MywzNi43NzkgMjguNzYwLDM0LjEwNiBMMzMuMDA2LDQyLjA2NiBMMjYuNjAxLDYwLjAwMCBMMy42MjUsNjAuMDAwIFoiIGNsYXNzPSJjbHMtMSIvPgo8L3N2Zz4K'\n\nfunction getType (src, isLoad) {\n  return isLoad ? 'loadImg' : src ? 'errorImg' : 'emptyImg'\n}\n// 配置项\nconst VALUE_KEYS = {\n  bgImage: {\n    keys: ['emptyImg', 'errorImg', 'loadImg'],\n    porperty: 'background-image',\n    handle (value) {\n      return `url(${value})`\n    },\n  },\n  bgColor: {\n    porperty: 'background-color',\n    handle (value, def = 'transparent') {\n      return value || def\n    },\n  },\n  bgSize: {\n    porperty: 'background-size',\n    handle (value, def = '50%') {\n      return value || def\n    },\n  },\n  bgPosition: {\n    porperty: 'background-position',\n    handle (value, def = 'center') {\n      return value || def\n    },\n  },\n  bgRepeat: {\n    porperty: 'background-repeat',\n    handle (value, def = 'no-repeat') {\n      return value || def\n    },\n  },\n}\n\nclass ImgLazyProcessor {\n  _commonOption\n  _elemOptions\n  _mutationObserver\n  _mutationOptions\n  _intersectionObserver\n  _mObserverCb = (records, observer) => {\n    records.map((record) => {\n      let imgEl = record.target\n      if (imgEl._unobserve) {\n        return\n      }\n      let option = this._elemOptions.get(imgEl)\n      switch (record.attributeName) {\n        case 'src':\n          break\n        case 'try-reload':\n          if (!record.oldValue || record.oldValue === 'true') {\n            imgEl.setAttribute('try-reload', 'false')\n          } else {\n            break\n          }\n          // eslint-disable-next-line no-fallthrough\n        case 'origin-src':\n          if (imgEl._isVisible) {\n            this._loadImg(imgEl, option)\n          } else {\n            imgEl._init = false\n          }\n          break\n        case 'style':\n          if (imgEl._inside > 0) {\n            imgEl._inside -= 1\n            break\n          }\n          // eslint-disable-next-line no-fallthrough\n        case 'class':\n        default:\n          if (imgEl._isVisible) {\n            if (imgEl._tips) {\n              ImgLazyProcessor.checkElemWH(imgEl)\n            }\n          } else {\n            imgEl._reset = true\n          }\n          break\n      }\n    })\n  }\n  _iObserverCb = (records, observer) => {\n    records.map((record) => {\n      let imgEl = record.target\n      imgEl._isVisible = record.isIntersecting\n      let option = this._elemOptions.get(imgEl)\n      if (!imgEl._isVisible) {\n        return\n      }\n      if (imgEl._reset) {\n        if (imgEl._tips) {\n          ImgLazyProcessor.checkElemWH(imgEl)\n        }\n        imgEl._reset = false\n      }\n      if (!imgEl._init) {\n        this._loadImg(imgEl, option)\n        imgEl._init = true\n      }\n    })\n  }\n\n  _loadImg (imgEl, option) {\n    let originSrc = (imgEl.getAttribute('origin-src') || '').trim()\n    if (!originSrc && imgEl._type === 'emptyImg') {\n      return\n    }\n    this._addTips(imgEl, true)\n    if (option.delay) {\n      this._setDelayTimer(imgEl, originSrc)\n    } else {\n      imgEl.setAttribute('src', originSrc)\n    }\n  }\n  // 延时加载图片\n  _setDelayTimer = (imgEl, originSrc) => {\n    this._clearDelayTimer(imgEl)\n    imgEl._timer = setTimeout((imgEl, originSrc) => {\n      imgEl.setAttribute('src', originSrc)\n    }, this._commonOption.delayTime, imgEl, originSrc)\n  }\n\n  _clearDelayTimer = (imgEl) => {\n    if (imgEl._timer) {\n      clearTimeout(imgEl._timer)\n      delete imgEl._timer\n    }\n  }\n\n  // 图片加载成功触发\n  _imgLoad = (e) => {\n    let imgEl = e.target\n    let src = imgEl.getAttribute('src')\n    if (src === PLACEHOLD_IMG) {\n      ImgLazyProcessor.checkElemWH(imgEl, this._commonOption.sizeLimit)\n    } else {\n      this._removeTips(imgEl)\n    }\n  }\n  // 图片加载失败触发\n  _imgError = (e) => {\n    let imgEl = e.target\n    this._addTips(imgEl)\n  }\n\n  // 图片去除提示\n  _removeTips = (imgEl) => {\n    let option = this._elemOptions.get(imgEl)\n    if (imgEl._tips) {\n      imgEl._tips = false\n      imgEl._type = ''\n      let tempElem = ImgLazyProcessor.getTempElem(imgEl)\n      for (let key in VALUE_KEYS) {\n        tempElem.style.removeProperty(VALUE_KEYS[key].porperty)\n      }\n      if (imgEl._delWidth) {\n        tempElem.style.removeProperty('width')\n        imgEl._delWidth = false\n      }\n      if (imgEl._delHeight) {\n        tempElem.style.removeProperty('height')\n        imgEl._delHeight = false\n      }\n      if (option.disable) {\n        tempElem.style.removeProperty('pointer-events')\n      }\n      ImgLazyProcessor.checkInside(imgEl, tempElem)\n      tempElem = null\n    }\n  }\n\n  // 图片增加提示\n  _addTips = (imgEl, isLoad) => {\n    let option = this._elemOptions.get(imgEl)\n    let originSrc = (imgEl.getAttribute('origin-src') || '').trim()\n    let imgHandleType = getType(originSrc, isLoad)\n    if (!imgEl._tips) {\n      imgEl._tips = true\n      imgEl._type = imgHandleType\n      let tempElem = ImgLazyProcessor.getTempElem(imgEl)\n      for (let key in VALUE_KEYS) {\n        let item = VALUE_KEYS[key]\n        if (item.keys) {\n          tempElem.style.setProperty(item.porperty, item.handle(option[imgHandleType] || this._commonOption[imgHandleType]))\n        } else {\n          tempElem.style.setProperty(item.porperty, item.handle(option[key], this._commonOption[key]))\n        }\n      }\n      if (option.disable) {\n        tempElem.style.setProperty('pointer-events', 'none')\n      }\n      ImgLazyProcessor.checkInside(imgEl, tempElem)\n      tempElem = null\n    } else {\n      if (imgEl._type !== imgHandleType) {\n        let tempElem = ImgLazyProcessor.getTempElem(imgEl)\n        imgEl._type = imgHandleType\n        let item = VALUE_KEYS.bgImage\n        tempElem.style.setProperty(item.porperty, item.handle(option[imgHandleType] || this._commonOption[imgHandleType]))\n        ImgLazyProcessor.checkInside(imgEl, tempElem)\n        tempElem = null\n      }\n    }\n    imgEl.setAttribute('src', PLACEHOLD_IMG)\n  }\n\n  constructor (commonOption = {}, exFilter = []) {\n    this._elemOptions = new WeakMap()\n    this._commonOption = {\n      loadImg: LOAD_IMG,\n      emptyImg: EMPTY_IMG,\n      errorImg: ERROR_IMG,\n      dataset: false,\n      bgColor: 'transparent', // '#aec2d3'\n      bgSize: '50%',\n      bgPosition: 'center',\n      bgRepeat: 'no-repeat',\n      sizeLimit: 2,\n      delay: false,\n      delayTime: 300,\n      disable: false,\n      ...commonOption,\n    }\n    this._mutationOptions = {\n      attributes: true,\n      attributeOldValue: true,\n      attributeFilter: ['origin-src', 'try-reload', 'class', 'style', ...exFilter],\n    }\n    this._mutationObserver = new MutationObserver(this._mObserverCb)\n    this._intersectionObserver = new IntersectionObserver(this._iObserverCb)\n  }\n\n  static updDataset (imgEl, option) {\n    for (let [key, value] of Object.entries(option)) {\n      imgEl.dataset[key] = value\n    }\n  }\n\n  static delDataset (imgEl, option) {\n    for (let key of Object.keys(option)) {\n      delete imgEl.dataset[key]\n    }\n  }\n\n  static getTempElem (imgEl) {\n    let tempElem = document.createElement('img')\n    tempElem.setAttribute('style', imgEl.getAttribute('style'))\n    return tempElem\n  }\n  static checkInside (imgEl, tempElem) {\n    let style = imgEl.getAttribute('style')\n    let tempStyle = tempElem.getAttribute('style')\n    if (style !== tempStyle) {\n      imgEl._inside += 1\n      imgEl.setAttribute('style', tempElem.getAttribute('style'))\n    }\n  }\n\n  static checkElemWH (imgEl, sizeLimit) {\n    let tempElem = ImgLazyProcessor.getTempElem(imgEl)\n    if (imgEl._delWidth) {\n      tempElem.style.removeProperty('width')\n      imgEl._delWidth = false\n    }\n    if (imgEl._delHeight) {\n      tempElem.style.removeProperty('height')\n      imgEl._delHeight = false\n    }\n    ImgLazyProcessor.checkInside(imgEl, tempElem)\n    let computedStyle = getComputedStyle(imgEl, '')\n    let compWidth = computedStyle.width && computedStyle.width.toLocaleLowerCase()\n    let compHeight = computedStyle.height && computedStyle.height.toLocaleLowerCase()\n    if (ImgLazyProcessor.checkWHLimit(compWidth, sizeLimit)) {\n      tempElem.style.setProperty('width', '100%')\n      imgEl._delWidth = true\n    }\n    if (ImgLazyProcessor.checkWHLimit(compHeight, sizeLimit)) {\n      tempElem.style.setProperty('height', '100%')\n      imgEl._delHeight = true\n    }\n    ImgLazyProcessor.checkInside(imgEl, tempElem)\n    tempElem = null\n  }\n\n  static checkWHLimit (size, sizeLimit) {\n    let mSize = (size || '-').replace('px', '')\n    return isNaN(mSize) || Number(mSize) <= sizeLimit\n  }\n\n  // {disable: false, delay: false, 'emptyImg':'', errorImg:'', loadImg: '', bgColor:'', bgSize:'', 'bgPosition': '', bgRepeat: ''}\n  observe (imgEl, option) {\n    let elemOption = this._elemOptions.get(imgEl)\n    if (!(imgEl instanceof HTMLElement) || imgEl.tagName !== 'IMG' || elemOption) {\n      return\n    }\n    if (!imgEl.src) {\n      imgEl.setAttribute('src', PLACEHOLD_IMG)\n    }\n    imgEl._init = false\n    imgEl._reset = true\n    imgEl._inside = 0\n    imgEl.addEventListener('load', this._imgLoad)\n    imgEl.addEventListener('error', this._imgError)\n    if (imgEl._unobserve) {\n      imgEl._unobserve = false\n    } else {\n      this._mutationObserver.observe(imgEl, this._mutationOptions)\n    }\n    this._intersectionObserver.observe(imgEl)\n    this.setElemOption(imgEl, option)\n  }\n\n  unobserve (imgEl) {\n    let option = this._elemOptions.get(imgEl)\n    if (!(imgEl instanceof HTMLElement) || imgEl.tagName !== 'IMG' || !option) {\n      return\n    }\n    this._clearDelayTimer(imgEl)\n    imgEl.removeEventListener('load', this._imgLoad)\n    imgEl.removeEventListener('error', this._imgError)\n    imgEl._unobserve = true\n    this._intersectionObserver.unobserve(imgEl)\n    if (this._commonOption.dataset) {\n      ImgLazyProcessor.delDataset(imgEl, option)\n    }\n    this._removeTips(imgEl)\n    this._elemOptions.delete(imgEl)\n  }\n\n  setElemOption (imgEl, option = {}) {\n    let mixOption = Object.assign(this._elemOptions.get(imgEl) || {}, option)\n    this._elemOptions.set(imgEl, mixOption)\n    if (this._commonOption.dataset) {\n      ImgLazyProcessor.updDataset(imgEl, mixOption)\n    }\n  }\n\n  destroy () {\n    this._mutationObserver.disconnect()\n    this._intersectionObserver.disconnect()\n  }\n}\n\nexport default ImgLazyProcessor\n"],"names":["window","IntersectionObserverEntry","prototype","TypeError","PLACEHOLD_IMG","LOAD_IMG","EMPTY_IMG","ERROR_IMG","VALUE_KEYS","bgImage","keys","porperty","handle","value","bgColor","bgSize","bgPosition","bgRepeat","commonOption","exFilter","records","observer","map","record","imgEl","target","_unobserve","option","_this","_elemOptions","get","attributeName","oldValue","setAttribute","_isVisible","_loadImg","_init","_inside","_tips","ImgLazyProcessor","checkElemWH","_reset","isIntersecting","originSrc","_clearDelayTimer","_timer","setTimeout","_commonOption","delayTime","clearTimeout","e","getAttribute","sizeLimit","_removeTips","_addTips","_type","tempElem","getTempElem","key","style","removeProperty","_delWidth","_delHeight","disable","checkInside","isLoad","imgHandleType","src","getType","trim","item","setProperty","WeakMap","loadImg","emptyImg","errorImg","dataset","delay","_mutationOptions","attributes","attributeOldValue","attributeFilter","_mutationObserver","MutationObserver","this","_mObserverCb","_intersectionObserver","IntersectionObserver","_iObserverCb","_setDelayTimer","elemOption","HTMLElement","tagName","addEventListener","_imgLoad","_imgError","observe","setElemOption","removeEventListener","unobserve","delDataset","delete","mixOption","Object","assign","set","updDataset","disconnect","entries","document","createElement","computedStyle","getComputedStyle","compWidth","width","toLocaleLowerCase","compHeight","height","checkWHLimit","size","mSize","replace","isNaN"],"mappings":"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"}